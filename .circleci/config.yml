version: 2.1

setup: true  # Habilita configuraci√≥n din√°mica

orbs:
  continuation: circleci/continuation@0.1.2  # Orb oficial de CircleCI para pipelines din√°micos

parameters:
  pipeline_config:
    type: string
    default: config_1.yml  # Usa config_1.yml como predeterminado

workflows:
  setup:
    jobs:
      - trigger_pipeline:  # Job que maneja la l√≥gica y validaci√≥n
          pipeline_config: << pipeline.parameters.pipeline_config >>

jobs:
  trigger_pipeline:
    docker:
      - image: cimg/base:stable  # Imagen base con CLI b√°sica
    parameters:
      pipeline_config:
        type: string
    steps:
      - checkout
      - run:
          name: Verificar Archivos en .circleci/
          command: |
            echo "üîç Verificando archivos en .circleci/"
            ls -la .circleci/
      - run:
          name: Validar y Continuar con Configuraci√≥n Din√°mica
          command: |
            CONFIG_FILE=".circleci/<< parameters.pipeline_config >>"
            
            echo "üîß Configuraci√≥n seleccionada: $CONFIG_FILE"
            
            if [ -f "$CONFIG_FILE" ]; then
              echo "‚úÖ Archivo encontrado: $CONFIG_FILE"
              
              # Elimina la validaci√≥n manual
              # circleci config validate "$CONFIG_FILE"
              
              # Usa el orb continuation directamente
              circleci continuation continue -c "$CONFIG_FILE"
            else
              echo "‚ùå ERROR: Archivo $CONFIG_FILE no encontrado"
              exit 1
            fi
