version: 2.1

setup: true  # Pipeline de setup din√°mico

orbs:
  continuation: circleci/continuation@0.1.2  # Orb oficial para pipelines din√°micos

parameters:
  pipeline_config:
    type: string
    default: config_1.yml

workflows:
  setup:
    jobs:
      - trigger_pipeline:  # Ejecuta el checkout y validaci√≥n
          pipeline_config: << pipeline.parameters.pipeline_config >>
jobs:
  trigger_pipeline:
    docker:
      - image: cimg/base:stable
    parameters:
      pipeline_config:
        type: string
    steps:
      - checkout  # Asegura que el c√≥digo est√© disponible
      - run:
          name: Verificar Archivos en .circleci/
          command: |
            echo "üîç Listando archivos en .circleci/"
            ls -la .circleci/
      - run:
          name: Validar Archivo de Configuraci√≥n
          command: |
            CONFIG_FILE=".circleci/<< parameters.pipeline_config >>"
            echo "üîß Configuraci√≥n seleccionada: $CONFIG_FILE"
            if [ -f "$CONFIG_FILE" ]; then
              echo "‚úÖ Archivo encontrado: $CONFIG_FILE"
              circleci config validate "$CONFIG_FILE"
            else
              echo "‚ùå ERROR: Archivo $CONFIG_FILE no encontrado"
              exit 1
            fi
      - continuation/continue:  # Continuar el pipeline din√°mico
          configuration_path: .circleci/<< parameters.pipeline_config >>
